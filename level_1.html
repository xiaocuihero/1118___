<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Very Basic 3D Viewer</title>
	<style type="text/css">
		input[type="number"] {
			width: 100px
		}
		input[type="text"]{
			width: 100px;
		}
	</style>
</head>

<body>
	<div>
		<div id="MyViewerDiv" style="width: 1600px; position: relative; height: 1000px;float: left;"></div>
		<div style="background-color: gray; width: 250px;position: relative; height: 1000px;float: right; ">
			
		</div>
	</div>

	<!-- The Viewer JS -->
	<script src="jquery-2.1.1.min.js"></script>
	<script src="three.min.js"></script>
	<!--  <script src="https://developer.api.autodesk.com/viewingservice/v1/viewers/viewer3D.min.js?v=v2.10"></script> -->
	<link rel="stylesheet" href="style.min.css" type="text/css">
	<script src="viewer3D.min.js"></script>	
 	
	 <script src="Autodesk.ADN.Viewing.Extension.Move.js"></script>-->
	 <script src="Autodesk.ADN.Viewing.Extension.TransformTool.js"></script>
	 <script src="Autodesk.ADN.Viewing.Extension.ContextMenu.js"></script>
	 <script src="Autodesk.ADN.Viewing.Extension.ModelStructure.js"></script>	 

	 <!-- <script type="text/javascript" src="scripts/aaa.js"></script> -->

	 <style type="text/css">

	 </style>

	 <script>

	 	// var testdata_ = [
		 // 	{"type":"room", "superId":1, "selfId": 1, "pos_index": 1, "infoId":1},
		 // 	{"type":"room", "pos_index":3, "infoId":3},
		 // 	{"type":"room", "selfId": 3, "pos_index": 4, "infoId":5},
		 // 	{"type":"tower", "selfId": 1, "infoId":7}
	 	// ];
	 	var testdata_ = [
	 		{"type":"room", "selfId": 5, "pos_index": 1, "infoId":1},
	 		{"type":"room", "selfId": 1, "pos_index": 2, "infoId":2},
	 		{"type":"tower", "selfId": 14, "pos_index": 1, "infoId":3},
	 	]
	 	var myViewerDiv = document.getElementById('MyViewerDiv');
	 	var viewer = new Autodesk.Viewing.Private.GuiViewer3D(myViewerDiv);
	 	var options = {
	 		'env' : 'Local',
	 		'document' : './svf/building.max/building.svf'
	 	}; 	

	 	// aaaa();
	 	Autodesk.Viewing.Initializer(options, function() {
	 		viewer.initialize ();	
	 		viewer.addEventListener (Autodesk.Viewing.GEOMETRY_LOADED_EVENT, function (event) {     
	 			viewer.fitToView (false) ;	 		               
	 			viewer.loadExtension('Autodesk.ADN.Viewing.Extension.ContextMenu');
	 			deleteToolbar();
	 			// viewer.setViewCube("[],[top],[]");
	 		}) ;	
	 	});	
 	
	</script>

	 <script type="text/javascript" src="scripts/tempData.js"></script>	 
	 <script type="text/javascript" src="scripts/testData.js"></script>
	 <script type="text/javascript" src="scripts/modelLoader.js"></script>
	 <script type="text/javascript" src="scripts/toolbarControler.js"></script>	 

 
<!-- 	 <script type="text/javascript" src="scripts/transformHelper.js"></script>	 
	 <script type="text/javascript" src="scripts/transformInfoReader.js"></script>
	 <script type="text/javascript" src="scripts/showHide.js"></script> -->


	 <script type="text/javascript">
	 	
		// var rooms = [];	 	
		// var towers = [];
		// var antennas = [];
		var models = [];
		var infos = [];
		var siteId = 1;
		CZLoadFloor();
		$.ajax({
			url:"./php/selectInfoLevelOne.php",
			type:"POST",
			data: {"siteId": siteId},
			dataType:"JSON",
			success:function(datas){
				// console.log(1);
				var rooms = [];
				var towers = [];
				var derricks=[];
				var antennas = [];
				for(var i in datas){
					if(datas[i].type == "room"){
						rooms.push(datas[i]);
					}else if(datas[i].type == "tower"){
						towers.push(datas[i]);						
					}else if(datas[i].type == "derrick"){
						derricks.push(datas[i]);
					}else if(datas[i].type == "antenna"){
						antennas.push(datas[i]);
					}
				}
				render(rooms, towers, derricks, antennas);
			}
		});


	 	function render(rooms, towers, derricks, antennas){
	 		for(var i in rooms){
	 			var data = rooms[i];
	 			data.pos_index = parseInt(i) + 1;
	 			CZLoad(data, function(modelr, datar){
	 				infos.push(datar);	 				
		 			// models.push(modelr);
		 		});
	 		}
	 		//Tower
	 		for(var i in towers){
	 			var dataT = towers[i];
	 			CZLoad(dataT, function(modelt, datat){
	 				infos.push(datat);
		 			// models.push(modelt);
		 			//Derrick
		 			// dfor:
		 			for(var j in derricks){
		 				var dataD = derricks[j];
		 				if(datat.para.infoId == dataD.superInfoId){
		 					dataD.superTrans = datat.dataTransM4;
		 					CZLoad(dataD, function(modeld, datad){		 						
		 						infos.push(datad);
		 						// models.push(modeld);
		 						// Antenna
		 						// afor:
		 						for(var k in antennas){
		 							var dataA = antennas[k];
		 							if(datad.para.infoId == dataA.superInfoId){
		 								dataA.superTrans = datad.dataTransM4;
		 								console.log(dataA);
		 								CZLoad(dataA, function(modela, dataa){
		 									infos.push(dataa);
		 									// models.push(modela);
		 								});
		 								// continue afor;
		 							}
		 							// console.log(1);
		 						}
		 						// console.log(datad);
		 					});
		 					// continue dfor;		
		 				}
		 			}			
		 		});
	 		}	 		 		
	 	}

	 	function groupDatas(datas, type1, type2, type3){
	 		var d1 = [];
	 		var d2 = [];
	 		var d3 = [];
	 		for(var i in datas){
	 			var data = datas[i];
	 			// data.type = data.TYPE;
	 			if(data.TYPE = type1){	 				
	 				d1.push(data);
	 			}else if(data.TYPE = type2){
	 				d2.push(data);	 				
	 			}else if(data.TYPE = type3){
	 				d3.push(data);
	 			}
	 		}
	 		return {"d1" : d1, "d2" : d2, "d3" : d3};
	 	}


	 	

	 	// console.log(models);
	 	// var para = {
	 	// 	type : "room",
	 	// 	infoId : 233
	 	// };
	 	// CZLoad(para, function(model, data){
	 	// 	console.log(model);
	 	// 	console.log(data);
	 	// });
	 </script>


</body>

</html>
